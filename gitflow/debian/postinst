#!/bin/bash
set -e

# Source path definitions
GITFLOW_SYSTEM_DIR="/usr/share/gitflow"
GITFLOW_PLUGINS_DIR="$GITFLOW_SYSTEM_DIR/plugins"
GITFLOW_PLUGIN_METADATA_DIR="$GITFLOW_PLUGINS_DIR/metadata"
GITFLOW_PLUGINS_REGISTRY="$GITFLOW_PLUGIN_METADATA_DIR/plugins.json"

case "$1" in
    configure)
        # Create directories with proper permissions
        mkdir -p "$GITFLOW_PLUGIN_METADATA_DIR"
        chmod 755 "$GITFLOW_PLUGIN_METADATA_DIR"
        
        # Initialize plugins registry
        echo '{"plugins":{}}' > "$GITFLOW_PLUGINS_REGISTRY"
        chmod 666 "$GITFLOW_PLUGINS_REGISTRY"
        
        # Set ownership
        chown -R root:root "$GITFLOW_SYSTEM_DIR"
        
        # Set permissions for executables
        find "$GITFLOW_SYSTEM_DIR" -type f -name "*.sh" -exec chmod 755 {} \;
        ;;

    abort-upgrade|abort-remove|abort-deconfigure)
        ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

exit 0